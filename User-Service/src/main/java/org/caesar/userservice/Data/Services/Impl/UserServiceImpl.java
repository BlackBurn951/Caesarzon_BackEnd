package org.caesar.userservice.Data.Services.Impl;

import lombok.RequiredArgsConstructor;
import org.caesar.userservice.Config.JwtConverter;
import org.caesar.userservice.Data.Dao.KeycloakDAO.UserRepository;
import org.caesar.userservice.Data.Services.UserService;
import org.caesar.userservice.Dto.PhoneNumberDTO;
import org.caesar.userservice.Dto.UserDTO;
import org.caesar.userservice.Dto.UserIdDTO;
import org.caesar.userservice.Dto.UserRegistrationDTO;
import org.modelmapper.ModelMapper;
import org.springframework.stereotype.Service;

import java.util.regex.Pattern;

@Service
@RequiredArgsConstructor
public class UserServiceImpl implements UserService {

    private final UserRepository userRepository;

    private final JwtConverter jwtConverter;

    private final ModelMapper modelMapper;


    @Override
    public UserDTO getUser() {
        String username= jwtConverter.getUsernameFromToken();
        return modelMapper.map(userRepository.findUserByUsername(username), UserDTO.class);
    }

    @Override
    public UserIdDTO getUserId() {
        String username= jwtConverter.getUsernameFromToken();
        return modelMapper.map(userRepository.findUserByUsername(username), UserIdDTO.class);
    }

    @Override
    public boolean saveUser(UserRegistrationDTO userRegistrationDTO) {
        if(userRegistrationDTO.getUsername()!= null &&
                userRegistrationDTO.getEmail()!= null &&
                userRegistrationDTO.getFirstName()!= null &&
                userRegistrationDTO.getLastName()!= null &&
                userRegistrationDTO.getCredentialValue()!= null) {

        }
        return userRepository.saveUser(userRegistrationDTO);
    }

    @Override
    public boolean savePhoneNumber(PhoneNumberDTO phoneNumberDTO) {
        return userRepository.savePhoneNumber(phoneNumberDTO);
    }



    //Metodi per la convalida dei dati
    private boolean checkUsername(String username) {
        return (username.length()>=5 && username.length()<=20) &&
                (Pattern.matches("^(?=.*[a-zA-Z].*[a-zA-Z].*[a-zA-Z].*[a-zA-Z])[a-zA-Z0-9]{5,20}$", username));
    }

    private boolean checkEmail(String email) {
        String[] domains= {'virgilio.it',
                'yahoo.it',
                'libero.it',
                'tim.it',
                'tiscali.it',
                'aruba.it',
                'hotmail.it',
                'live.it',
                'iol.it',
                'inwind.it',
                'fastweb.it',
                'vodafone.it',
                'studenti.unical.it',
                'wind.it',
                'supereva.it',
                'katamail.it',
                'infinito.it',
                'mynet.it',
                'tin.it',
                'lycos.it',
                'email.it',
                'siciliamail.it',
                'gmx.it',
                'teletu.it',
                'google.it',
                'microsoft.it',
                'apple.it',
                'register.it',
                'poste.it',
                'telecomitalia.it',
                'panservice.it',
                'outlook.it',
                'ovh.it',
                'btitalia.it',
                'italiaonline.it',
                'aliceposta.it',
                'tiscali.it',
                'hotmail.it',
                'libero.it',
                'inwind.it',
                'iol.it',
                'supereva.it',
                'katamail.it',
                'teletu.it',
                'tin.it',
                'email.it',
                'lycos.it',
                'infinito.it',
                'virgilio.it',
                'gmx.it',
                'mynet.it',
                'siciliamail.it',
                'google.it',
                'microsoft.it',
                'apple.it',
                'register.it',
                'poste.it',
                'telecomitalia.it',
                'panservice.it',
                'outlook.it',
                'ovh.it',
                'btitalia.it',
                'italiaonline.it',
                'fastwebnet.it',
                'intesasanpaolo.it',
                'ing.it',
                'bancaintesa.it',
                'intesasanpaoloassistance.it',
                'bancapopolare.it',
                'mediolanum.it',
                'bper.it',
                'unicredit.it',
                'poste.it',
                'fineco.it',
                'bancaditalia.it',
                'intesa.it',
                'enel.it',
                'trenitalia.it',
                'rai.it',
                'mediaset.it',
                'sky.it',
                'windtre.it',
                'vodafone.it',
                'tim.it',
                'tre.it',
                'coop.it',
                'conad.it',
                'esselunga.it',
                'unieuro.it',
                'trony.it',
                'euronics.it',
                'amazon.it',
                'ebay.it',
                'zalando.it',
                'yoox.it',
                'asos.it',
                'netflix.it',
                'spotify.it',
                'youtube.it',
                'facebook.it',
                'instagram.it',
                'twitter.it',
                'linkedin.it',
                'whatsapp.it',
                'telegram.it',
                'gmail.it',
                'outlook.it',
                'yahoo.it',
                'hotmail.it',
                'libero.it',
                'tin.it',
                'iol.it',
                'aruba.it',
                'register.it',
                'fastweb.it',
                'vodafone.it',
                'wind.it',
                'supereva.it',
                'katamail.it',
                'infinito.it',
                'mynet.it',
                'lycos.it',
                'email.it',
                'siciliamail.it',
                'gmx.it',
                'teletu.it',
                'google.it',
                'microsoft.it',
                'apple.it',
                'aliceposta.it',
                'tiscali.it',
                'hotmail.it',
                'libero.it',
                'inwind.it',
                'iol.it',
                'supereva.it',
                'katamail.it',
                'teletu.it',
                'tin.it',
                'email.it',
                'lycos.it',
                'infinito.it',
                'virgilio.it',
                'gmx.it',
                'mynet.it',
                'siciliamail.it',
                'google.it',
                'microsoft.it',
                'apple.it',
                'register.it',
                'poste.it',
                'telecomitalia.it',
                'panservice.it',
                'outlook.it',
                'ovh.it',
                'btitalia.it',
                'italiaonline.it',
                'fastwebnet.it',
                'intesasanpaolo.it',
                'ing.it',
                'bancaintesa.it',
                'intesasanpaoloassistance.it',
                'bancapopolare.it',
                'mediolanum.it',
                'bper.it',
                'unicredit.it',
                'poste.it',
                'fineco.it',
                'bancaditalia.it',
                'intesa.it',
                'enel.it',
                'trenitalia.it',
                'rai.it',
                'mediaset.it',
                'sky.it',
                'windtre.it',
                'vodafone.it',
                'tim.it',
                'tre.it',
                'coop.it',
                'conad.it',
                'esselunga.it',
                'unieuro.it',
                'trony.it',
                'euronics.it',
                'amazon.it',
                'ebay.it',
                'zalando.it',
                'yoox.it',
                'asos.it',
                'netflix.it',
                'spotify.it',
                'youtube.it',
                'facebook.it',
                'instagram.it',
                'twitter.it',
                'linkedin.it',
                'whatsapp.it',
                'telegram.it',
                'gmail.it',
                'outlook.it',
                'yahoo.it',
                'hotmail.it',
                'libero.it',
                'tin.it',
                'iol.it',
                'aruba.it',
                'register.it',
                'fastweb.it',
                'vodafone.it',
                'wind.it',
                'supereva.it',
                'katamail.it',
                'infinito.it',
                'mynet.it',
                'lycos.it',
                'email.it',
                'siciliamail.it',
                'gmx.it',
                'teletu.it',
                'google.it',
                'microsoft.it',
                'apple.it',
                'register.it',
                'poste.it',
                'telecomitalia.it',
                'panservice.it',
                'outlook.it',
                'ovh.it',
                'btitalia.it',
                'italiaonline.it',
                'aliceposta.it',
                'tiscali.it',
                'hotmail.it',
                'libero.it',
                'inwind.it',
                'iol.it',
                'supereva.it',
                'katamail.it',
                'teletu.it',
                'tin.it',
                'email.it',
                'lycos.it',
                'infinito.it',
                'virgilio.it',
                'gmx.it',
                'mynet.it',
                'siciliamail.it',
                'google.it',
                'microsoft.it',
                'apple.it',
                'register.it',
                'poste.it',
                'telecomitalia.it',
                'panservice.it',
                'outlook.it',
                'ovh.it',
                'btitalia.it',
                'italiaonline.it',
                'fastwebnet.it',
                'intesasanpaolo.it',
                'ing.it',
                'bancaintesa.it',
                'intesasanpaoloassistance.it',
                'bancapopolare.it',
                'mediolanum.it',
                'bper.it',
                'unicredit.it',
                'poste.it',
                'fineco.it',
                'bancaditalia.it',
                'intesa.it',
                'enel.it',
                'trenitalia.it',
                'rai.it',
                'mediaset.it',
                'sky.it',
                'windtre.it',
                'vodafone.it',
                'tim.it',
                'tre.it',
                'coop.it',
                'conad.it',
                'esselunga.it',
                'unieuro.it',
                'trony.it',
                'euronics.it',
                'amazon.it',
                'ebay.it',
                'zalando.it',
                'yoox.it',
                'asos.it',
                'netflix.it',
                'spotify.it',
                'youtube.it',
                'facebook.it',
                'instagram.it',
                'twitter.it',
                'linkedin.it',
                'whatsapp.it',
                'telegram.it',
                'gmail.it',
                'outlook.it',
                'yahoo.it',
                'hotmail.it',
                'libero.it',
                'tin.it',
                'iol.it',
                'aruba.it',
                'register.it',
                'fastweb.it',
                'vodafone.it',
                'wind.it',
                'supereva.it',
                'katamail.it',
                'infinito.it',
                'mynet.it',
                'lycos.it',
                'email.it',
                'siciliamail.it',
                'gmx.it',
                'teletu.it',
                'google.it',
                'microsoft.it',
                'apple.it',
                'aliceposta.it',
                'tiscali.it',
                'hotmail.it',
                'libero.it',
                'inwind.it',
                'iol.it',
                'supereva.it',
                'katamail.it',
                'teletu.it',
                'tin.it',
                'email.it',
                'lycos.it',
                'infinito.it',
                'virgilio.it',
                'gmx.it',
                'mynet.it',
                'siciliamail.it',
                'google.it',
                'microsoft.it',
                'apple.it',
                'register.it',
                'poste.it',
                'telecomitalia.it',
                'panservice.it',
                'outlook.it',
                'ovh.it',
                'btitalia.it',
                'italiaonline.it',
                'fastwebnet.it',
                'intesasanpaolo.it',
                'ing.it',
                'bancaintesa.it',
                'intesasanpaoloassistance.it',
                'bancapopolare.it',
                'mediolanum.it',
                'bper.it',
                'unicredit.it',
                'poste.it',
                'fineco.it',
                'bancaditalia.it',
                'intesa.it',
                'enel.it',
                'trenitalia.it',
                'rai.it',
                'mediaset.it',
                'sky.it',
                'windtre.it',
                'vodafone.it',
                'tim.it',
                'tre.it',
                'coop.it',
                'conad.it',
                'esselunga.it',
                'unieuro.it',
                'trony.it',
                'euronics.it',
                'amazon.it',
                'ebay.it',
                'zalando.it',
                'yoox.it',
                'asos.it',
                'netflix.it',
                'spotify.it',
                'youtube.it',
                'facebook.it',
                'instagram.it',
                'twitter.it',
                'linkedin.it',
                'whatsapp.it',
                'telegram.it',
                'gmail.it',
                'outlook.it',
                'yahoo.it',
                'hotmail.it',
                'gmail.com',
                'yahoo.com',
                'hotmail.com',
                'outlook.com',
                'icloud.com',
                'aol.com',
                'live.com',
                'mail.com',
                'protonmail.com',
                'fastmail.com',
                'zoho.com',
                'yandex.com',
                'gmx.com',
                'rocketmail.com',
                'mail.ru',
                'tutanota.com',
                'seznam.cz',
                'inbox.lv',
                'mailinator.com',
                'outlook.es',
                'office365.com',
                'apple.com',
                'google.com',
                'yahoo.co.jp',
                'qq.com',
                '163.com',
                'sina.com',
                'aliyun.com',
                'naver.com',
                'daum.net',
                'naver.com',
                'yahoo.co.uk',
                'msn.com',
                'btinternet.com',
                'bluewin.ch',
                'web.de',
                't-online.de',
                'orange.fr',
                'free.fr',
                'wanadoo.fr',
                'laposte.net',
                'sfr.fr',
                'example.org',
                'organization.org',
                'nonprofit.org'}
        int atIndex= email.indexOf("@");

        String beforeAt= email.substring(0, atIndex);
        String afterAt= email.substring(atIndex+1);


    }

    private boolean checkFirstName(String firstName) {
        return (firstName.length()>=2 && firstName.length()<=30) &&
                (Pattern.matches("^[a-zA-Z]{2,}( [a-zA-Z]{2,30})?$", firstName));
    }

    private boolean checkLastName(String lastName) {
        return (lastName.length()>=2 && lastName.length()<=30) &&
                (Pattern.matches("^[a-zA-Z]{2,}( [a-zA-Z]{2,30})?$", lastName));
    }

    private boolean checkCredentialValue(String credentialvalue) {
        return (credentialvalue.length()>=8 && credentialvalue.length()<=20) &&
                (Pattern.matches("^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[!@#$%^&*()_+])[A-Za-z\\d!@#$%^?&*()_+]{8,20}$", credentialvalue));
    }
}
